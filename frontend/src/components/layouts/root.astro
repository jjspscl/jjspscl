---
import { ClientRouter } from "astro:transitions";

import { createPersonSchema, createWebSiteSchema } from "@features/seo";

import "@styles/tailwind.css";
import "@styles/animate.css";

interface Props {
  title?: string;
  description?: string;
  image?: string;
  type?: "website" | "article";
  publishedDate?: string;
  schemaType?: "home" | "page" | "article";
}

const { 
  title, 
  description = "Joshua Pascual - Software Engineer passionate about building modern web applications. Explore my projects, blog posts, and get in touch.",
  image = "/me.png",
  type = "website",
  publishedDate,
  schemaType = "page"
} = Astro.props;

const language = Astro.url.searchParams.get("lang") as string;
const defaultTitle = "Joshua Pascual | Software Engineer";
const fullTitle = title ? `${title} | Joshua Pascual` : defaultTitle;
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const imageURL = new URL(image, Astro.site);

const personSchema = createPersonSchema();
const webSiteSchema = createWebSiteSchema();
---
<html lang={language === "en-ph" ? "tl" : "en"}>
    <head>
        <meta charset="utf-8" />
        <meta content="width=device-width, initial-scale=1.0" name="viewport" />
        <meta content={Astro.generator} name="generator" />
        
        <!-- Primary Meta Tags -->
        <title>{fullTitle}</title>
        <meta name="title" content={fullTitle} />
        <meta name="description" content={description} />
        <meta name="author" content="Joshua Pascual" />
        <meta name="keywords" content="Joshua Pascual, jjspscl, software developer, web developer, full stack developer, portfolio, blog, projects" />
        <link rel="canonical" href={canonicalURL} />
        
        <!-- Favicon -->
        <link href="/favicon.svg" rel="icon" type="image/svg+xml" />
        <link rel="apple-touch-icon" href="/me.png" />
        
        <!-- Open Graph / Facebook -->
        <meta property="og:type" content={type} />
        <meta property="og:url" content={canonicalURL} />
        <meta property="og:title" content={fullTitle} />
        <meta property="og:description" content={description} />
        <meta property="og:image" content={imageURL} />
        <meta property="og:site_name" content={defaultTitle} />
        <meta property="og:locale" content="en_US" />
        {publishedDate && <meta property="article:published_time" content={publishedDate} />}
        
        <!-- Twitter -->
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:url" content={canonicalURL} />
        <meta name="twitter:title" content={fullTitle} />
        <meta name="twitter:description" content={description} />
        <meta name="twitter:image" content={imageURL} />
        
        <!-- Additional SEO -->
        <meta name="robots" content="index, follow" />
        <meta name="googlebot" content="index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1" />
        
        <!-- Sitemap -->
        <link href="/sitemap-index.xml" rel="sitemap" />
        
        <!-- LLMs.txt for AI/LLM discoverability -->
        <link rel="alternate" type="text/markdown" href="/llms.txt" title="LLM-friendly site information" />
        
        <!-- JSON-LD Structured Data - Person Schema -->
        <script is:inline type="application/ld+json" set:html={JSON.stringify(personSchema)} />
        
        <!-- JSON-LD Structured Data - WebSite Schema (for sitelinks) -->
        {schemaType === "home" && (
          <script is:inline type="application/ld+json" set:html={JSON.stringify(webSiteSchema)} />
        )}
        
        <ClientRouter />
    </head>
    <body class="flex flex-col min-h-screen">
        <slot/>
    </body>
</html>
