---
import BaseLayout from "@layouts/base.astro";
import { useStoryblokApi, type ISbResult } from "@storyblok/astro";
import Article from "@components/storyblok/blog/Article.astro";
export const prerender = false;

const storyblokApi = useStoryblokApi();
const slug = Astro.params.slug;
let content: ISbResult | null = null;
const language = Astro.url.searchParams.get("lang") as string;

try {
  const { data } = await storyblokApi.get(`cdn/stories/blog/${slug}`, {
    version: import.meta.env.DEV ? "draft" : "published",
    language,
  });

  if (!data) {
    return Astro.redirect("/404");
  }

  content = data.story.content;
} catch (error) {
  return Astro.redirect("/404");
}
---

<BaseLayout>
  <Article blok={content} slug={slug ?? ""} />
</BaseLayout>
